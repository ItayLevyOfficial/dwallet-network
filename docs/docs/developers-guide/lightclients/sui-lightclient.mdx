---
title: Control dWallets from Sui
---

# Sui Lightclient
dWallet Network leverages the [Sui Light Client](https://github.com/MystenLabs/sui/tree/main/crates/sui-light-client) to integrate with Sui, bringing dWallets trustlessly into the Sui Network.
This allows developers to enforce their dWallet logic in Sui modules on the Sui Mainnet, bringing trustless and programmable Bitcoin, Ethereum and almost any other asset on Web3 to Sui, and allowing other solutions such as fast decentralized custody to be built.

The dWallet module is published to Sui Devnet at `0x4d8aea37b683f7fba2ae345d7ee3f4a278f1c06b8f716c02c725b0e461dee1f3`.
This module should be used by Sui builders to build their own modules, which means that end applications will not interact with this module directly.
For this reason, we will not fully explain and document how to interact with it, but will only giving the bare minimum cli examples.
This module is in its early stages and we should anticipate breaking changes and improvements.

## A dWallet Capability on Sui is linked to the Wrapped dWallet Capability on the dWallet Network
After [following these steps to create a dWallet](../getting-started/your-first-dwallet.md), you should have ownership of the `DWalletCap` object that has absolute control over it.

In order to control it from a Sui module, the `DWalletCap` object from the Sui dWallet module is used.
Ownership of this object will allow complete control over the dWallet linked to it; thus, limiting control over this object (e.g. by wrapping it by your own module's object) effectively allows controlling the dWallet linked to it.
```rust
struct DWalletCap has key, store {
        id: UID,
}
```
To create a `DWalletCap` object, run the following command:
```shell
sui client ptb \ --move-call sui::tx_context::sender \ --assign sender \ --move-call <DWALLET-PACKAGE-ID>::sui_state_proof::create_cap \ --assign cap \ --transfer-objects \[cap\] sender \ --gas-budget 50000000
```

sui client ptb \ --move-call sui::tx_context::sender \ --assign sender \ --move-call 0x4d8aea37b683f7fba2ae345d7ee3f4a278f1c06b8f716c02c725b0e461dee1f3::sui_state_proof::create_cap \ --assign cap \ --transfer-objects \[cap\] sender \ --gas-budget 50000000


This command will produce the following output (truncated):
```shell
Transaction Digest: HaBQTZQ7Dqc4gyR9rXmEt3yiviyXVwZQ3azbp924nDJG

╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Transaction Block Events                                                                                                 │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  ┌──                                                                                                                     │
│  │ EventID: HaBQTZQ7Dqc4gyR9rXmEt3yiviyXVwZQ3azbp924nDJG:0                                                               │
│  │ PackageID: 0x4d8aea37b683f7fba2ae345d7ee3f4a278f1c06b8f716c02c725b0e461dee1f3                                         │
│  │ Transaction Module: sui_state_proof                                                                                   │
│  │ Sender: 0x69bbf6545d930e77e1fe56c28f8cad87595fbebc76b46d380abb33b5cfaf57ec                                            │
│  │ EventType: 0x4d8aea37b683f7fba2ae345d7ee3f4a278f1c06b8f716c02c725b0e461dee1f3::sui_state_proof::DWalletNetworkRequest │
│  │ ParsedJSON:                                                                                                           │
│  │   ┌─────────┬────────────────────────────────────────────────────────────────────┐                                    │
│  │   │ cap_id  │ 0x34127a42bac51d1294361ed82de5b3d41653866f896f106ea37c983eb9f9e807 │                                    │
│  │   ├─────────┼────────────────────────────────────────────────────────────────────┤                                    │
│  │   │ message │                                                                    │                                    │
│  │   └─────────┴────────────────────────────────────────────────────────────────────┘                                    │
│  └──                                                                                                                     │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
```
As you can see, this transaction emits a `DWalletNetworkRequest` event that specifies the Object ID (0x34127a42bac51d1294361ed82de5b3d41653866f896f106ea37c983eb9f9e807) of the newly created `DWalletCap` object.
Currently, we use the same Move object both for the creation of the capability and approval of messages for signing, and it looks like this:
The owner, whether it be an EOA on Sui or another object on Sui that is controlled by a Sui module, of this `DWalletCap` may call `fun approve_message(cap: &DWalletCap, message: vector<u8>)` to approve any message, which emits a `DWalletNetworkRequest` event.
```rust
struct DWalletNetworkRequest has copy, drop {
        cap_id: ID,
        message: vector<u8>,
}
```

Next, call the `submitDwalletCreationProof()` function, which will take submit a state proof to the dWallet network that this transaction `txid = HaBQTZQ7Dqc4gyR9rXmEt3yiviyXVwZQ3azbp924nDJG` on Sui Devnet created a new `DWalletCap`.
```typescript
await submitDwalletCreationProof(
    dwallet_client,
    sui_client,
    configObjectId,
    dwalletCapId,
    txId,
    serviceUrl,
    keyPair,
);
```
This will create a new `CapWrapper` object in dWallet Network, that wraps the `DWalletCap` and registers the corresponding `cap_id` on Sui, thus forming the link between the two objects:
```rust
struct CapWrapper has key, store {
        id: UID,
        cap_id_sui: ID,
        cap: DWalletCap,
}
```

## Approve Message on Sui for Signing in dWallet Network
Now that our dWallet is linked to a `DWalletCap` on Sui, its owner can use it to approve a message for signing.

Let's say we want to sign the message `"dWallets are coming... to Sui"`, its base64 encoding is `ZFdhbGxldHMgYXJlIGNvbWluZy4uLiB0byBTdWk=` and we will run the following command:
```shell
sui client ptb \
--move-call <DWALLET-PACKAGE-ID>::sui_state_proof::approve_message @<DWALLET-CAP-ID> "'dWallets are coming... to Sui'" \
--gas-budget 50000000
```

This command will produce the following output (truncated):
```shell
Transaction Digest: ApQpAYDXR2tzq5rf2qRVmUqnfc7CjqB7uY6ZgtsG7KXz

╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Transaction Block Events                                                                                                 │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  ┌──                                                                                                                     │
│  │ EventID: ApQpAYDXR2tzq5rf2qRVmUqnfc7CjqB7uY6ZgtsG7KXz:0                                                               │
│  │ PackageID: 0x4d8aea37b683f7fba2ae345d7ee3f4a278f1c06b8f716c02c725b0e461dee1f3                                         │
│  │ Transaction Module: sui_state_proof                                                                                   │
│  │ Sender: 0x69bbf6545d930e77e1fe56c28f8cad87595fbebc76b46d380abb33b5cfaf57ec                                            │
│  │ EventType: 0x4d8aea37b683f7fba2ae345d7ee3f4a278f1c06b8f716c02c725b0e461dee1f3::sui_state_proof::DWalletNetworkRequest │
│  │ ParsedJSON:                                                                                                           │
│  │   ┌─────────┬────────────────────────────────────────────────────────────────────┐                                    │
│  │   │ cap_id  │ 0x34127a42bac51d1294361ed82de5b3d41653866f896f106ea37c983eb9f9e807 │                                    │
│  │   ├─────────┼────────────────────────────────────────────────────────────────────┤                                    │
│  │   │ message │ ZFdhbGxldHMgYXJlIGNvbWluZy4uLiB0byBTdWk=                           │                                    │
│  │   └─────────┴────────────────────────────────────────────────────────────────────┘                                    │
│  └──                                                                                                                     │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
```
Now the emitted `DWalletNetworkRequest` event also specify the message that was approved by the `DWalletCap` object.

Now from typescript [we follow the steps to sign with a dWallet](../getting-started/your-first-dwallet.md) but we stop after creating the `signMessages` object.
Next, we call the `submitDwalletCreationProof()` function, which will take submit a state proof to the dWallet network that this transaction `txid = ApQpAYDXR2tzq5rf2qRVmUqnfc7CjqB7uY6ZgtsG7KXz` on Sui Devnet approved this message for signing.
```typescript
let res = await submitTxStateProof(
    dwallet_client,
    sui_client,
    configObjectId,
    capWrapperRef,
    signMessagesIdSHA256,
    txId,
    serviceUrl,
    keyPair,
);

console.log('res', res);
```
This will generate a signature.
